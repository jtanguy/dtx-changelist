\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{changelist}[2012/07/10 v0.1 Manage change lists]

\RequirePackage{ifdraft}
\RequirePackage{tabularx}

\RequirePackage{translator}
\usedictionary{changelist}

% Note: the changelist is a list of rows of a tabular environment
\newtoks\changelist@list

% Reset the list
\changelist@list{}

% Define changes internal command
% Adds a row to the changelist
% The syntax is: <version><date><author><description>
\newcommand{\final}[4]{%
  \changelist@list=\expandafter{\the\changelist@list #1&#2&#3&#4\\\hline}
}

\newcommand{\draft}[4]{%
  \ifdraft{%
    \changelist@list=\expandafter{\the\changelist@list \emph{#1}&\emph{#2}&\emph{#3}&\emph{#4}\\\hline}
  }{%
    \relax
  }
}

% Print changelist
\newcommand{\printchangelist}{%
  \ifx\chapter\@undefined
    \section*{\translate{Change list}}
  \else
    \chapter*{\translate{Change list}}
  \fi
  \noindent
  \begin{tabularx}{\textwidth}{|c|c|c|X|}
    \hline
    \textbf{\translate{Version}} & \textbf{\translate{Date}} & \textbf{\translate{Author}} & \textbf{\translate{Description}} \\ \hline
    \the\changelist@list
  \end{tabularx}
  \bigskip
}


